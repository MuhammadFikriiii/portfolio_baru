<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Artikel - Portofolio</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: { sans: ["Inter", "sans-serif"] },
            colors: {
              "electric-blue": "#00BFFF",
              "dark-bg": "#0F0F23",
              "dark-card": "#1A1A2E",
            },
            keyframes: {
              gradient: {
                "0%, 100%": { backgroundPosition: "0% 50%" },
                "50%": { backgroundPosition: "100% 50%" },
              },
              pulse: {
                "0%, 100%": { opacity: 1 },
                "50%": { opacity: 0.5 },
              }
            },
            animation: {
              gradient: "gradient 15s ease infinite",
              "pulse-slow": "pulse 3s infinite",
            },
          },
        },
      };
    </script>
    <style type="text/css">
      .gradient-bg {
        background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
      }
      .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      /* Skeleton Loading Effect */
      .skeleton {
        background: linear-gradient(90deg, #1a1a2e 25%, #2a2a4e 50%, #1a1a2e 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
      }
      @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }
    </style>
  </head>
  <body class="bg-dark-bg text-white min-h-screen">
    
    <!-- Navigasi -->
    <div class="flex items-center gap-2 ml-10 mt-6">
        <a href="../index.html" class="text-white hover:text-electric-blue transition-colors">
            <i class="fa-solid fa-arrow-left"></i> Kembali
        </a>
    </div>

    <section id="artikel-section" class="py-10 scroll-mt-14">
      <div class="container mx-auto px-4">
        <div class="mb-12 text-center max-w-2xl mx-auto">
          <h2 class="relative gradient-bg bg-clip-text text-transparent text-4xl font-bold inline-block">
            Artikel Terbaru
          </h2>
          <p class="text-gray-400 mt-2">Berbagi wawasan seputar teknologi, finansial, dan hobi.</p>
        </div>

        <!-- Container Artikel (Akan diisi oleh JS) -->
        <div id="articles-container" class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
          <!-- Loading Skeletons -->
          <div class="flex flex-col bg-dark-card rounded-2xl h-96 skeleton"></div>
          <div class="flex flex-col bg-dark-card rounded-2xl h-96 skeleton"></div>
          <div class="flex flex-col bg-dark-card rounded-2xl h-96 skeleton"></div>
        </div>

        <!-- Pesan jika Error atau Kosong -->
        <div id="status-message" class="hidden text-center py-20">
            <p id="message-text" class="text-gray-500 text-lg"></p>
        </div>
      </div>
    </section>

    <script>
      const SUPABASE_URL = "https://geydchzpcjpwwqljzias.supabase.co";
      const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdleWRjaHpwY2pwd3dxbGp6aWFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxODQ3ODcsImV4cCI6MjA4MTc2MDc4N30.o_KspHsrzHNBgKayScG2ZAVj_KlchS5xkHLgBviykp4";

      /**
       * Fungsi untuk mengambil data artikel dari Supabase
       */
      async function loadArticles() {
        const container = document.getElementById("articles-container");
        const statusMsg = document.getElementById("status-message");
        const msgText = document.getElementById("message-text");

        try {
          // Perubahan: Menggunakan tabel 'artikel' bukan 'articles'
          const res = await fetch(
            `${SUPABASE_URL}/rest/v1/artikel?select=*&order=tgl_publish.desc`,
            {
              headers: {
                apikey: SUPABASE_KEY,
                Authorization: `Bearer ${SUPABASE_KEY}`,
              },
            }
          );

          if (!res.ok) {
            const errorData = await res.json();
            console.error("Supabase Error:", errorData);
            throw new Error(errorData.message || "Gagal mengambil data.");
          }

          const articles = await res.json();

          if (articles.length === 0) {
            container.innerHTML = "";
            statusMsg.classList.remove("hidden");
            msgText.innerText = "Belum ada artikel yang dipublikasikan.";
            return;
          }

          renderArticles(articles);
        } catch (error) {
          console.error("Error Detail:", error);
          container.innerHTML = "";
          statusMsg.classList.remove("hidden");
          msgText.innerText = "Terjadi kesalahan saat memuat artikel. Pastikan koneksi stabil dan tabel database sudah benar.";
        }
      }

      /**
       * Fungsi untuk merender list artikel ke HTML
       */
      function renderArticles(data) {
        const container = document.getElementById("articles-container");

        container.innerHTML = data
          .map((item) => {
            // Format tanggal agar lebih rapi
            const date = new Date(item.tgl_publish).toLocaleDateString("id-ID", {
              day: "numeric",
              month: "short",
              year: "numeric",
            });

            // Fallback gambar jika kosong
            const imageSrc = item.gambar || "https://via.placeholder.com/600x400?text=No+Image";

            return `
              <article class="flex flex-col bg-dark-card rounded-2xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300 group">
                <div class="relative h-52 w-full overflow-hidden">
                  <img
                    src="${imageSrc}"
                    alt="${item.judul}"
                    class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"
                    onerror="this.src='https://via.placeholder.com/600x400?text=Image+Error'"
                  />
                  <div class="absolute inset-0 bg-gradient-to-t from-dark-bg/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                </div>

                <div class="flex flex-1 flex-col justify-between p-6">
                  <div>
                    <div class="flex items-center gap-x-4 text-xs mb-4">
                      <time class="text-gray-400 flex items-center gap-1">
                        <i class="fa-regular fa-calendar text-[10px]"></i> ${date}
                      </time>
                      <span class="relative z-10 rounded-full bg-electric-blue/10 px-3 py-1 font-medium text-electric-blue border border-electric-blue/20">
                        ${item.kategori || "Umum"}
                      </span>
                    </div>

                    <div class="relative">
                      <h3 class="text-xl font-bold leading-7 mb-3">
                        <a href="detail-artikel.html?slug=${item.slug}" class="hover:text-electric-blue transition-colors duration-200">
                          ${item.judul}
                        </a>
                      </h3>
                      <p class="line-clamp-3 text-sm leading-6 text-gray-400">
                        ${item.konten ? item.konten.replace(/<[^>]*>/g, '').substring(0, 160) : "Tidak ada ringkasan tersedia."}...
                      </p>
                    </div>
                  </div>
                  
                  <div class="mt-6 pt-4 border-t border-white/5 flex justify-between items-center">
                    <a href="detail-artikel.html?slug=${item.slug}" class="text-electric-blue text-sm font-semibold flex items-center gap-2 group-hover:gap-3 transition-all">
                      Baca Selengkapnya <i class="fa-solid fa-arrow-right text-xs"></i>
                    </a>
                  </div>
                </div>
              </article>
            `;
          })
          .join("");
      }

      // Jalankan fungsi saat DOM sudah siap
      document.addEventListener("DOMContentLoaded", loadArticles);
    </script>
  </body>
</html>